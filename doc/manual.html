<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
 <head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 1st June 2002), see www.w3.org">

  <title>Henkari</title>
  <meta name="GENERATOR" content=
  "Modular DocBook HTML Stylesheet Version 1.76b+">
 </head>

 <body class="article" bgcolor="#FFFFFF" text="#000000" link="#0000FF"
 vlink="#840084" alink="#0000FF">
  <div class="ARTICLE">
   <div class="TITLEPAGE">
    <h1 class="title"><a name="index">Henkari</a></h1>

    <h3 class="author"><a name="AEN4">Tero Tilus</a></h3>

    <div class="affiliation">
     <span class="jobtitle">Distance-learning designer<br>
     </span><span class="orgname">Jyv&auml;skyl&auml; open university<br>
     </span>
    </div>

    <p class="pubdate">$Date: 2002/11/12 12:40:33 $<br>
    </p>

    <div>
     <div class="abstract">
      <a name="AEN17"></a>

      <p>Dynamic extensible website framework in object-oriented php.</p>
     </div>
    </div>
    <hr>
   </div>

   <div class="TOC">
    <dl>
     <dt><b>Table of Contents</b></dt>

     <dt>1. <a href="#sec_introduction">Introduction</a></dt>

     <dd>
      <dl>
       <dt>1.1. <a href="#AEN21">Henkari?</a></dt>

       <dt>1.2. <a href="#AEN24">Motivation</a></dt>

       <dt>1.3. <a href="#AEN27">Purpose</a></dt>

       <dt>1.4. <a href="#AEN31">Terminology</a></dt>

       <dt>1.5. <a href="#AEN60">Features</a></dt>
      </dl>
     </dd>

     <dt>2. <a href="#sec_structure">Structure</a></dt>

     <dd>
      <dl>
       <dt>2.1. <a href="#AEN80">Files and directories</a></dt>

       <dt>2.2. <a href="#sec_howdoesitwork">How does it work (by
       example)</a></dt>
      </dl>
     </dd>

     <dt>3. <a href="#sec_setup">Setting up henkari</a></dt>

     <dd>
      <dl>
       <dt>3.1. <a href="#AEN172">Requirements</a></dt>

       <dt>3.2. <a href="#sec_installation">Installation</a></dt>

       <dt>3.3. <a href="#sec_configuration">Configuration</a></dt>
      </dl>
     </dd>

     <dt>4. <a href="#sec_building">Building website with henkari</a></dt>

     <dd>
      <dl>
       <dt>4.1. <a href="#AEN280">Getting started</a></dt>

       <dt>4.2. <a href="#sec_templates">Template system</a></dt>

       <dt>4.3. <a href="#AEN308">Handlers</a></dt>

       <dt>4.4. <a href="#sec_building_variables">Automatic template
       variables</a></dt>

       <dt>4.5. <a href="#sec_includes">Includes</a></dt>

       <dt>4.6. <a href="#AEN504">Builtin server side cache</a></dt>
      </dl>
     </dd>

     <dt>5. <a href="#sec_extending">Extending</a></dt>

     <dd>
      <dl>
       <dt>5.1. <a href="#AEN524">User defined handlers</a></dt>

       <dt>5.2. <a href="#AEN548">Your PHP scripts in henkari</a></dt>

       <dt>5.3. <a href="#sec_extending_interfaces">Interfaces</a></dt>
      </dl>
     </dd>

     <dt>A. <a href="#AEN771">Appendices</a></dt>

     <dd>
      <dl>
       <dt>A.1. <a href="#AEN773">License agreement</a></dt>
      </dl>
     </dd>
    </dl>
   </div>

   <div class="section">
    <h1 class="section"><a name="sec_introduction">1.
    Introduction</a></h1>

    <div class="section">
     <h2 class="section"><a name="AEN21">1.1. Henkari?</a></h2>

     <p>Henkari is a dynamic extensible server-side website framework with
     oo-php. Word &quot;henkari&quot; is finnish. It translates as
     &quot;hanger&quot;. Henkari helps you to keep your website nicely in
     shape a bit like hanger keeps your jacket.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN24">1.2. Motivation</a></h2>

     <p>Doing manually something which computer is (when properly tuned
     up) fully capable of doing by itself is merely stupid. Maintaining
     even a simple website on flat-file basis without any html generation
     tools may include loads of that stupid hacking. Things like changing
     site layout, adding and removing pages and updating toc and
     navigation links.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN27">1.3. Purpose</a></h2>

     <p>Henkari is a server-side website framework. It&#39;s purpose is
     minimize excess work of website maintainer. It provides template
     hierarchy, dynamic TOC/path/menu, (optional) online editing (security
     depends on webserver setup), extensibility and configurability.</p>

     <p>Example: Adding a new page to your site includes creating it with
     your favorite html editor and saving it to your web folder.
     That&#39;s all. TOC gets (and also many other things get) updated
     automagically.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN31">1.4. Terminology</a></h2>

     <div class="formalpara">
      <p><b>Handler.</b> A module providing some (additional)
      functionality to henkari. To be accurate, handler is a class
      inherited from <tt class="classname">abstractHandler</tt>.</p>
     </div>

     <div class="formalpara">
      <p><b>TOC.</b> Table of contents -like (not necessarily the table of
      contents) dynamically folding tree of navigational choises.</p>
     </div>

     <div class="formalpara">
      <p><b>Menu.</b> Single step navigational choises on current context.
      Currently contains all entries on TOC &quot;up&quot; and
      &quot;down&quot; from viewed entry. Horizontal (&quot;next&quot; and
      &quot;prev&quot;) are to be implemented.</p>
     </div>

     <div class="formalpara">
      <p><b>Path.</b> Several meanings. In navigational context path is
      the path from mainpage to current page.</p>
     </div>

     <div class="formalpara">
      <p><b>Entrypoint.</b> is the root address/directory of the webspace
      handled by henkari. It&#39;s the directory where your <tt class=
      "filename">index.php</tt> (so called entrypoint script) or link to
      it, <tt class="filename">config.php</tt> and <tt class=
      "filename">lib/</tt> / <tt class="filename">phplib/</tt> directories
      (or links to them) reside.</p>
     </div>

     <div class="formalpara">
      <p><b>Henkari webroot.</b> Henkari&#39;s root directory for website
      content. May be referred as &quot;webroot&quot; in this document.
      Default is <tt class="filename">root/</tt> under entrypoint.</p>
     </div>

     <div class="formalpara">
      <p><b>Henkari webtree.</b> Directory tree under henkari webroot. May
      be referred as &quot;webtree&quot; in this document.</p>
     </div>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN60">1.5. Features</a></h2>

     <div class="formalpara">
      <p><b>Templates.</b> Henkari uses phplib to implement template
      functionality to ease the separation of content and look/feel.
      Templates are well-formed (x)html files and you can create and
      modify them with your favorite html editor. Templates apply to the
      directory where they reside (and all the subdirectories) and can be
      nested. Nesting is performed by using only body of the template that
      is to be nested within the current template. To lear more see <a
      href="#sec_templates">Section 4.2</a>.</p>
     </div>

     <div class="formalpara">
      <p><b>Dynamic navigation.</b> From file/directory structure and user
      defined exceptions Henkari automatically generates navigational
      elements: dynamically folding table of contents, menu and path.</p>
     </div>

     <div class="formalpara">
      <p><b>Distributed configuration.</b> You can alter just about
      everything per directory(tree) basis. If you know Apache&#39;s <tt
      class="filename">.htaccess</tt> configuration files, you are already
      familiar with the consept. There are two separate (both are
      optional) configuration files. First (<tt class=
      "filename">.index</tt> and <tt class="filename">_index</tt>, both
      are read) contains additional TOC entry definitions and second (<tt
      class="filename">.henkari</tt> and <tt class=
      "filename">_henkari</tt>, both are used) is evaluated as php-code.
      See <a href="#sec_configuration">Section 3.3</a> to learn more.</p>
     </div>
    </div>
   </div>

   <div class="section">
    <hr>

    <h1 class="section"><a name="sec_structure">2. Structure</a></h1>

    <div class="section">
     <h2 class="section"><a name="AEN80">2.1. Files and
     directories</a></h2>

     <p>Directory listing from root directory of henkari shows the
     following.</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color="#000000"><tt class=
"prompt">bash$</tt> cd /dir/where/you/extracted/henkari
<tt class="prompt">bash$</tt> ls -la
drwxr-sr-x    7 terotil  users        4096 Jul  1 13:08 .
drwsr-sr-x    8 terotil  users        4096 Jun 25 13:39 ..
-rw-r--r--    1 terotil  users       17983 Jul  1 11:10 COPYING
drwxr-sr-x    5 terotil  users        4096 Jul  1 14:07 doc
-rw-r--r--    1 terotil  users          85 Jun 24 18:53 example.htaccess
-rw-r--r--    1 terotil  users        1378 Jul 30 15:29 index.php
drwxr-sr-x    3 terotil  users        4096 Jul  1 11:41 lib
drwxr-sr-x    5 terotil  users        4096 Jun 25 11:05 root
-rw-r--r--    1 terotil  users         952 Jul  1 13:08 TODO
<tt class="prompt">bash$</tt></font>
</pre>
       </td>
      </tr>
     </table>

     <p><tt class="filename">COPYING</tt> contains license and <tt class=
     "filename">TODO</tt> describes the road ahead. Documentation is found
     from <tt class="filename">doc/</tt>, program code from <tt class=
     "filename">lib/</tt> and website from <tt class=
     "filename">root/</tt>. <tt class="filename">index.php</tt> is
     entrypoint script to Henkari. <tt class=
     "filename">example.htaccess</tt> contains an example of Apache (<tt
     class="filename">mod_rewrite</tt>) configuration to hide <tt class=
     "filename">index.php</tt> from url. There may be something else too,
     but you need to know only these.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_howdoesitwork">2.2. How does it work
     (by example)</a></h2>

     <p>Henkari works recursively starting from it&#39;s root
     web-directory (default is <tt class="filename">root/</tt> under
     entrypoint) and ending to requested file/directory. On each step
     forward along the request path (when there&#39;s still path left) a
     decision is made: Who handles the the next step? Configuration files
     placed on directories that are examined during a single request can
     have effect on the result. For example they can change the rules
     which provide answer to the previously presented question.</p>

     <p>Let&#39;s have an example. Assume Henkari&#39;s entrypoint script
     <tt class="filename">index.php</tt> in <tt class=
     "filename">/entry/point/dir/</tt> which is seen as <tt class=
     "filename">http://www.somesite.net/somepath/</tt> by J. Random
     Surfer. Now in default Henkari configuration the website is located
     in <tt class="filename">/entry/point/dir/root/</tt>. Assume we have
     there a configfile <tt class=
     "filename">/entry/point/dir/root/.henkari</tt></p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="programlisting">
<font color="#000000"> &lt;?php

 // Get singleton instance of handlerFactory.
 $hf =&amp; handlerFactory::getInstance();

 // Register a handler for html-files.
 $hf-&gt;registerHandler(&#39;text/html&#39;, &#39;htmlHandler&#39;);

 ?&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>a template <tt class=
     "filename">/entry/point/dir/root/_template.html</tt></p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="programlisting">
<font color="#000000"> &lt;html&gt;
   &lt;head&gt;&lt;title&gt;{title}&lt;/title&gt;&lt;/head&gt;
   &lt;body&gt;
     &lt;div style=&quot;width: 65em&quot;&gt;
 {content}
     &lt;/div&gt;
   &lt;/body&gt;
 &lt;/html&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>and a webpage <tt class=
     "filename">/entry/point/dir/root/random/page.html</tt></p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="programlisting">
<font color=
"#000000"> &lt;html&gt;&lt;head&gt;&lt;title&gt;Footitle&lt;/title&gt;&lt;/head&gt;
 &lt;body&gt;
   &lt;p&gt;This is a foopage.&lt;/p&gt;
 &lt;/body&gt;&lt;/html&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>Now when request is made to retrieve the assumed page, url looks
     (without any server-side tricks) like this: <tt class=
     "filename">http://www.somesite.net/somepath/index.php/random/page.html</tt>.
     This causes webserver to execute entrypoint script <tt class=
     "filename">http://www.somesite.net/somepath/index.php</tt>, which
     (when caching is on) checks if the page has been requested before and
     saved to page cache. If it&#39;s not, it parses remaining path <tt
     class="filename">/random/page.html</tt> to array <tt class=
     "constant">(&quot;random&quot;, &quot;page.html&quot;)</tt>. Then it
     asks <tt class="classname">handlerFactory</tt> to return a proper
     handler for <tt class="filename">/entry/point/dir/root/</tt>, gives
     the previously parsed array to the returned handler and calls
     it&#39;s <tt class="function">handle()</tt> -function.</p>

     <p>Handlers share common interface and are instantiated by <tt class=
     "classname">handlerFactory</tt>. It decides which handler gets
     instantiated for which file. The decision is made upon file&#39;s
     type (is it a directory, symlink, regular file, etc.) and name.</p>

     <p>Because <tt class="filename">/entry/point/dir/root/</tt> is a
     directory <tt class="classname">handlerFactory</tt> instantiates a
     <tt class="classname">dirHandler</tt>. First <tt class=
     "classname">dirHandler</tt> searches &quot;current directory&quot;
     (<tt class="filename">/entry/point/dir/root/</tt>) for configuration
     files and template. Configuration file <tt class=
     "filename">.henkari</tt> (See <a href="#dothenkari">Section
     3.3.3</a>) is found and evaluated as php-code. It tells <tt class=
     "classname">handlerFactory</tt> which handlers to use with files of
     certain mimetype. Template (<tt class=
     "filename">/entry/point/dir/root/_template.html</tt>) is found too
     and user interface (an instance of <tt class="classname">UI</tt>) is
     ordered to use the newly found template. Then handler searches
     current directory for entries not beginning with dot or underscore
     and not ending with tilde and adds them to TOC. In this case
     there&#39;s only directory <tt class="filename">random/</tt> (See <a
     href="#dotindex">Section 3.3.2</a>). Next thing <tt class=
     "classname">dirHandler</tt> does is to check if there still is path
     left to travel. It pops <tt class="constant">&quot;random&quot;</tt>
     from the left end of <tt class="constant">(&quot;random&quot;,
     &quot;page.html&quot;)</tt> and thus reduces the array to <tt class=
     "constant">(&quot;page.html&quot;)</tt>. Then it appends popped <tt
     class="constant">&quot;random&quot;</tt> to &quot;current
     directory&quot; resulting <tt class=
     "filename">/entry/point/dir/root/random/</tt>, asks <tt class=
     "classname">handlerFactory</tt> a handler for it and passes control
     to returned handler along with remaining path <tt class=
     "constant">(&quot;page.html&quot;)</tt>.</p>

     <p><tt class="filename">/entry/point/dir/root/random/</tt> is
     directory too, so <tt class="classname">handlerFactory</tt>
     instantiated and returned <tt class="classname">dirHandler</tt> and
     the same procedure starts again. Configuration files and template are
     searched, but not found. Directory is listed and <tt class=
     "filename">page.html</tt> is added to TOC as child of <tt class=
     "filename">random/</tt>. Then handler pops <tt class=
     "constant">&quot;page.html&quot;</tt> from path, appends it to
     &quot;current directory&quot; resulting <tt class=
     "filename">/entry/point/dir/root/random/page.html</tt>. Handler gives
     it to <tt class="classname">handlerFactory</tt>, requests a new
     handler and passes control to it.</p>

     <p>File <tt class=
     "filename">/entry/point/dir/root/random/page.html</tt> is recognized
     by Henkari to be of type &quot;text/html&quot;. Evaluation of
     configuration file <tt class=
     "filename">/entry/point/dir/root/.henkari</tt> registered <tt class=
     "classname">htmlHandler</tt> to be responsible of mimetype
     &quot;text/html&quot;. So <tt class="classname">handlerFactory</tt>
     instantiates <tt class="classname">htmlHandler</tt> and control is
     passed to it. Handler reads <tt class=
     "filename">/entry/point/dir/root/random/page.html</tt>, extracts the
     contents of <tt class="constant">&lt;title&gt;</tt> and <tt class=
     "constant">&lt;body&gt;</tt> and tells the <tt class=
     "classname">UI</tt> to append them to page title and page
     content.</p>

     <p>Handler recursion ends to <tt class="classname">htmlHandler</tt>
     and control passes back to entrypoint script, which commands <tt
     class="classname">UI</tt> to send page. <tt class="classname">UI</tt>
     uses data passed to it to render page.</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="programlisting">
<font color="#000000"> &lt;html&gt;
   &lt;head&gt;&lt;title&gt;Footitle&lt;/title&gt;&lt;/head&gt;
   &lt;body&gt;
     &lt;div style=&quot;width: 65em&quot;&gt;
 
   &lt;p&gt;This is a foopage.&lt;/p&gt;
 
     &lt;/div&gt;
   &lt;/body&gt;
 &lt;/html&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>Then (if no handler opted out caching) it saves the result with
     optional http-headers to page cache, sends it to browser of J. Random
     Surfer and exits.</p>
    </div>
   </div>

   <div class="section">
    <hr>

    <h1 class="section"><a name="sec_setup">3. Setting up henkari</a></h1>

    <div class="section">
     <h2 class="section"><a name="AEN172">3.1. Requirements</a></h2>

     <p>In theory where ever you can make PHP4 or better to work henkari
     will follow. Properly setting up an entrypoint that is separate from
     the place where henkari itself is located requires filesystem with
     symbolic links (or equivalent feature), but it&#39;s not
     required.</p>

     <p>In Debian environment you need packages <tt class=
     "constant">php4</tt> and <tt class="constant">phplib</tt>. Phplib
     program files appear in <tt class="filename">/usr/lib/phplib</tt> and
     when creating an entrypoint (see <a href="#sec_entrypoint">Section
     3.2.4</a>) you can link them from there.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_installation">3.2.
     Installation</a></h2>

     <div class="section">
      <h3 class="section"><a name="AEN182">3.2.1. Obtain</a></h3>

      <p>Henkari can be obtained from <a href=
      "http://www.math.jyu.fi/~terotil/" target=
      "_top">http://www.math.jyu.fi/~terotil/</a></p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN186">3.2.2. Extract</a></h3>

      <p>Extract the distribution package on a place where you keep your
      local program files.</p>

      <p>It&#39;s recommended that when really using henkari, you
      don&#39;t put files under any web directory but create entrypoint
      separately (<a href="#sec_entrypoint">Section 3.2.4</a>) and that
      way can share henkari program files between several websites and
      make updating henkari easier. For testing purposes it&#39;s
      perfectly OK to extract files under web directory and use the
      directory where henkari resides as an entrypoint.</p>

      <p>If you have GNU tar, extracting goes with command.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000"><tt class=
"prompt">bash$</tt> tar --extract --ungzip --file=henkari.tar.gz</font>
</pre>
        </td>
       </tr>
      </table>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN194">3.2.3. PHPLib</a></h3>

      <div class="note">
       <table class="note" width="100%" border="0">
        <tr>
         <td width="25" align="center" valign="top"><img src=
         "../images/note.gif" hspace="5" alt="Note"></td>

         <td align="left" valign="top">
          <p>Currently henkari distribution includes program files from
          phplib-7.4-pre1. If you already have phplib on your machine, you
          can during entrypoint creation link you existing phplib instead
          of phplib-7.4-pre1 which came with henkari distribution.</p>
         </td>
        </tr>
       </table>
      </div>

      <p>Henkari uses functionality from phplib. So if you don&#39;t
      already have it and it didn&#39;t come with henkari distribution,
      obtain it from <a href="http://sourceforge.net/projects/phplib/"
      target="_top">http://sourceforge.net/projects/phplib/</a>, extract
      package and copy directory containing library files (<tt class=
      "filename">php/</tt>) to your shared php-code location. Henkari
      should work with any phplib from 7.x on.</p>

      <p>Henkari assumes phplib library files reside in <tt class=
      "filename">phplib/</tt> when looking from the directory where
      entrypoint script is. Quick way is to symlink phplib library
      directory to entrypoint directory.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000"><tt class=
"prompt">bash$</tt> cd /dir/where/entrypoint/script/is 
<tt class=
"prompt">bash$</tt> ln -s /shared/php/code/phplib-code-dir/ phplib</font>
</pre>
        </td>
       </tr>
      </table>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="sec_entrypoint">3.2.4. Create
      entrypoint</a></h3>

      <p>If you use the directory where henkari actually resides as and
      entrypoint too, you don&#39;t have to do anything special. Extracted
      henkari directory serves as an entrypoint right out-of-box. Creating
      entrypoint this way can make updating and local an error-prone task.
      It&#39;s OK for testing purposes, but creating separate entrypoint
      is recommended.</p>

      <p>Creating separate entrypoint starts with creating (web)directory
      that will serve the entrypoint. Copy <tt class=
      "filename">config.php</tt> to that directory. Create (symbolic)
      links to <tt class="filename">doc/</tt>, <tt class=
      "filename">lib/</tt>, <tt class="filename">phplib/</tt> directories
      and <tt class="filename">index.php</tt>. Create <tt class=
      "filename">root/</tt> and <tt class="filename">pagecache/</tt>
      directories (or which ever are approppriate for you. These can be
      changed from configuration). Now you should have working
      entrypoint.</p>

      <p>Good smoke test is to put whatever (html-)file to <tt class=
      "filename">root/</tt> directory and point your browser to entrypoint
      directory. You should see a link pointing to that file and clicking
      should show that file. Assume my webroot is <tt class=
      "filename">/var/www/</tt> and I have henkari entrypoint at <tt
      class="filename">/var/www/henkari/</tt>. Now I would copy my <tt
      class="filename">whatever.html</tt> to <tt class=
      "filename">/var/www/henkari/root/</tt>, point my browser to <tt
      class="filename">http://myhost/henkari/</tt> and see (if henkari is
      working) a page with single link &quot;Whatever&quot; pointing to
      <tt class=
      "filename">http://myhost/henkari/index.php/whatever.html</tt>.</p>
     </div>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_configuration">3.3.
     Configuration</a></h2>

     <p>Henkari&#39;s configuration has three levels. General settings
     have global defaults, which are located in <tt class=
     "filename">lib/henkariConfig.class.php</tt>. General settings for
     each entrypoint reside in <tt class="filename">config.php</tt> in the
     entrypoint directory in question. Third level is distributed
     configuration under webroot.</p>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN230">3.3.1. General
      settings</a></h3>

      <p>General settings apply to single entrypoint. File containing
      those settings is <tt class="filename">config.php</tt> and it&#39;s
      located in the entrypoint directory. Example configuration coming
      with henkari distribution contains only few settings to give an
      example of the syntax. You can find the rest of the configuration
      variables from <tt class="filename">lib/henkariConfig.class.php</tt>
      where their global defaults are set. Setting variable in <tt class=
      "filename">config.php</tt> overrides the global default.</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="dotindex">3.3.2. <tt class=
      "filename">.index</tt></a></h3>

      <p>Dotindex-file contains all the exceptions to the rules (see <a
      href="#sec_building_variables_navigational">Section 4.4.1</a>) along
      which automatic navigational elements are built. If found, both <tt
      class="filename">.index</tt> and <tt class="filename">_index</tt>
      are used.</p>

      <p>Syntax of dotindex looks like this.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000"># Comment
map    somefile    Label of some file
map    somedir/    Label of some dir
pseudo nonexisting Another label
hide   filenottoshow</font>
</pre>
        </td>
       </tr>
      </table>

      <p>Lines beginning with hash are ignored (Note that hash must be the
      first character.). All the other lines are split on two first
      sequences of whitespace (sequence of only spaces and tabs). First
      part is interpreted as command and the rest (one or two) are
      parameters. Three commands (see the syntax example abow) are
      recognized.</p>

      <div class="variablelist">
       <dl>
        <dt>map</dt>

        <dd>
         <p>Maps file/directory to a new name. This new name is used in
         automatic navigational elements to represent the file/directory
         in question. First parameter is the name of the file/directory
         and the second is the name to use for that file/directory. Note
         that you must append a trailing slash to directory names.</p>
        </dd>

        <dt>pseudo</dt>

        <dd>
         <p>Adds an entry to automatic navigational elements. First
         parameter is the address used in links and the second is the name
         to use for that entry.</p>
        </dd>

        <dt>hide</dt>

        <dd>
         <p>Hides matching files/directories from navigational elements. A
         file/directory is not shown if a match against any hide-pattern
         is found from it&#39;s name. Hide-patterns apply to the directory
         where they appear and all subdirectories. Patterns are POSIX
         extended regular expressions (see The Open Group Base
         Specifications Issue 6, Chapter 9 <a href=
         "http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html"
          target=
         "_top">http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap09.html</a>).</p>

         <p>Note that this only hides files from automatic navigational
         elements. It doesn&#39;t prevent user from requesting them. You
         can still link to these hidden items, but automatic table of
         contents (see <a href=
         "#sec_building_variables_navigational">Section 4.4.1</a>) may
         behave unexpectedly.</p>
        </dd>
       </dl>
      </div>

      <p>As you may have noticed, only the second parameter may contain
      whitespaces. So mapping names having whitespaces is currently
      impossible. Take this into account in your naming conventions.</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="dothenkari">3.3.3. <tt class=
      "filename">.henkari</tt></a></h3>

      <p>Dothenkari is executed as php-code before the directory where it
      resides is examined. It must be a well formed php-file. If found,
      both <tt class="filename">.henkari</tt> and <tt class=
      "filename">_henkari</tt> are used. Dothenkari gives you direct
      access to internals of henkari in the middle of it&#39;s road
      towards requested file. You can redefine pretty much everything.</p>

      <p>A straightforward way to implement two alternate templates and
      parameter driven switching between them is to put following code in
      <tt class="filename">.henkari</tt> in webroot.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color=
"#000000">if ( &#39;print&#39; == CGI::safeLookupGP(&#39;tpl&#39;, &#39;screen&#39;) ) {
  global $config;
  $config-&gt;templatefile = &#39;_template_print.html&#39;;
}</font>
</pre>
        </td>
       </tr>
      </table>

      <p>If now in get or post variables there is variable &#39;tpl&#39;
      having value &#39;print&#39;. Configuration is altered so that <tt
      class="filename">_template_print.html</tt> is used as template
      instead of default <tt class="filename">_template.html</tt>. Now you
      only need the templates and links between them.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000">[
&lt;a href=&quot;{this_uri}?tpl=screen&quot;&gt;normal&lt;/a&gt; |
&lt;a href=&quot;{this_uri}?tpl=print&quot;&gt;printable&lt;/a&gt;
]</font>
</pre>
        </td>
       </tr>
      </table>

      <p>To lear more about the possibilities available in dothenkari you
      should read <a href="#sec_extending">Section 5</a>.</p>
     </div>
    </div>
   </div>

   <div class="section">
    <hr>

    <h1 class="section"><a name="sec_building">4. Building website with
    henkari</a></h1>

    <div class="section">
     <h2 class="section"><a name="AEN280">4.1. Getting started</a></h2>

     <p>With it&#39;s default file handler <a href=
     "#sec_handlers_asis">Section 4.3.2</a> henkari does pretty much
     nothing different when comparing to an ordinary webserver. Usually
     the first thing to do is to register handlers for the filetypes you
     want henkari to be aware of. Builtin html-handler (see <a href=
     "#sec_handlers_html">Section 4.3.3</a>) with default directory and
     file handlers should be enough for small and moderate websites. You
     can register html handler by creating to your root directory a
     dothenkari (file named <tt class="filename">.henkari</tt> or <tt
     class="filename">_henkari</tt>) with the following content.</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="programlisting">
<font color="#000000"> &lt;?php
 $hf =&amp; handlerFactory::getInstance();
 $hf-&gt;registerHandler(&#39;text/html&#39;, &#39;htmlHandler&#39;);
 ?&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>Now when you have html handler enabled on your website html files
     behave intelligetly with templates and you can start building your
     website.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_templates">4.2. Template
     system</a></h2>

     <p>Henkari uses templates from phplib. Phplib templates are ordinary
     html files with some &quot;magical&quot; markings. Words within curly
     braces are <tt class="varname">{markers}</tt> that are to be replaced
     with some content that is spesific to viewed page. These markers are
     called template variables.</p>

     <p>Henkari automatically provides content for number of template
     variables (see <a href="#sec_building_variables">Section 4.4</a>).
     With those template variables known by henkari you can describe how
     your template should be used. i.e. Where to put page content, last
     modification time, table of contents, etc. The most important
     template variable is <tt class="constant">{content}</tt> which is
     replaced with the content of page. You should always have it in every
     template you create.</p>

     <p>Name of the template file is <tt class=
     "filename">_template.html</tt> and you may (but you are not required
     to) have one in each directory in your henkari webtree. First
     template encountered is used as master template. If another template
     is found when walking further along request path, it&#39;s nested in
     master template (if not explisitly set otherwise, see <a href=
     "#dotindex">Section 3.3.2</a>).</p>

     <p>Master template is used directly, no modifications are done. In
     nesting operation master template&#39;s <tt class=
     "constant">{content}</tt> -variable is replaced with the content of
     nested template&#39;s <tt class="constant">&lt;body&gt;</tt> tag.</p>

     <p>References in templates must be written so that they don&#39;t
     break when pages in different directories are wrapped in the same
     template. Assume we have in webroot a stylesheet file <tt class=
     "filename">style.css</tt>, template having</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color=
"#000000">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style.css&quot;&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>and also two pages, one in webroot and another in a directory
     under webroot. When the first page in webroot is requested everyting
     works fine, but on the second page stylesheet is not found because
     it&#39;s looked from the directory where the page is in. So we must
     use absolute address for stylesheet. At this point henkari helps us a
     little. There&#39;s a template variable <tt class=
     "constant">{entrypoint_uri}</tt> which is automatically replaced with
     an address to henkari webroot. So we can write</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color=
"#000000">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;{entrypoint_uri}style.css&quot;&gt;</font>
</pre>
       </td>
      </tr>
     </table>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN308">4.3. Handlers</a></h2>

     <p>Henkari has a subsystem called &quot;handler factory&quot;.
     It&#39;s given a filename and it decides which handler should that
     file be given to. Handlers provide the actual functionality. Handlers
     that you want to use, must be properly registered to handler factory.
     Henkari comes with a number of predefined handlers, but only default
     directory handler (see <a href="#sec_handlers_dir">Section 4.3.1</a>)
     and default file handler (see <a href="#sec_handlers_asis">Section
     4.3.2</a>) are used unless you register more.</p>

     <p>Next sections describe the handlers coming with henkari
     distribution.</p>

     <div class="section">
      <hr>

      <h3 class="section"><a name="sec_handlers_dir">4.3.1. Directories
      (<tt class="classname">dirHandler</tt>)</a></h3>

      <p>This is the default directory handler. It&#39;s used when
      filename given to handler factory points to a directory. In the real
      world it means that <tt class="classname">dirHandler</tt> is used
      until recursion reaches the requested file (if there is one) or
      another directory handler is registered. Assume we have site <tt
      class="filename">http://www.somesite.net/somepath/</tt>, entrypoint
      directory <tt class="filename">/entry/point/dir/</tt> and request
      <tt class=
      "filename">http://www.somesite.net/somepath/index.php/some/file.html</tt>
      coming in. Now <tt class="filename">/entry/point/dir/root/</tt> and
      <tt class="filename">/entry/point/dir/root/some/</tt> are given to
      <tt class="classname">dirHandler</tt> and <tt class=
      "filename">/entry/point/dir/root/some/file.html</tt> by default to
      As-is file handler.</p>

      <p><tt class="classname">dirHandler</tt> is responsible of the most
      of henkari core functionality: Executing per-directory special file
      dothenkari (see <a href="#dothenkari">Section 3.3.3</a>), setting
      per-directory templates (see <a href="#sec_templates">Section
      4.2</a>), interpreting per-directory special file dotindex (see <a
      href="#dotindex">Section 3.3.2</a>), creating table of contents,
      menu and path (see <a href=
      "#sec_building_variables_navigational">Section 4.4.1</a>)</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="sec_handlers_asis">4.3.2. Files
      &quot;as-is&quot; (<tt class="classname">asisHandler</tt>)</a></h3>

      <p>This is the default file handler. It&#39;s used when filename
      given to handler factory points to an ordinary file and no other
      handlers are registered to be responsible of handling that file.
      This handler just sets <tt class="constant">Content-type:</tt> http
      header to reflect the MIME-type of the file and sends the content of
      that file, which is pretty much what would (efectively) happen
      without henkari.</p>

      <p>If you for example want to have a download-link and direct
      browsing (as described in <a href="#sec_handlers_packages">Section
      4.3.5</a>) link to a gzip package, &quot;intelliget&quot; behavior
      of henkari is not desired. As-is file handler can be forced by
      giving a http get parameter <tt class="constant">asis</tt> value <tt
      class="constant">yes</tt>. (Append <tt class=
      "constant">?asis=yes</tt> to download url)</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="sec_handlers_html">4.3.3. Html files
      (<tt class="classname">htmlHandler</tt>)</a></h3>

      <p>This handler makes henkari behave more intelligently with html
      files. When handled by <tt class="classname">htmlHandler</tt>, html
      files are embedded to page template (see <a href=
      "#sec_templates">Section 4.2</a>), content of html file&#39;s <tt
      class="constant">&lt;body&gt;</tt> tag is appended to page content
      (which gets at it&#39;s turn to replace <tt class=
      "constant">{content}</tt> template variable), content of html
      file&#39;s <tt class="constant">&lt;title&gt;</tt> tag is appended
      to page title and so on.</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="sec_handlers_php">4.3.4. Php scripts
      (<tt class="classname">phpHandler</tt>)</a></h3>

      <p>This handler executes (with <tt class="function">include()</tt>)
      a php script, buffers it&#39;s output and appends the output to page
      content. There are no special requirements to php scripts executed
      with <tt class="classname">phpHandler</tt>. There are a few minor
      limitations though. Script is not executed in global namespace as a
      plain php script without henkari would but in <tt class=
      "function">phpHandler::handle()</tt>. Remember to explisitely
      introduce global variables as global. If you want to bypass the
      template system you have to use <tt class=
      "constant">UI::responseData</tt> and <tt class=
      "function">UI::addHeader()</tt> (see <a href=
      "#sec_extending_interfaces">Section 5.3</a>) to make your response
      work and have it correctly cached. I could look like this.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000">&lt;?php
// Get user interface
$ui =&amp; UI::getInstance();

// Set response content type
$ui-&gt;addHeader(&#39;Content-type: application/x-shockwave-flash&#39;);

// Set response data
$swf_data = create_some_nifty_flash();
$ui-&gt;responseData = $swf_data;
?&gt;</font>
</pre>
        </td>
       </tr>
      </table>

      <p>Simple rule for generating your own response from within henkari
      means first retrieving instance of <tt class="classname">UI</tt> and
      replacing &quot;<tt class="function">header()</tt>&quot; with
      &quot;<tt class="function">UI::addHeader()</tt>&quot; and &quot;<tt
      class="constant">echo</tt>&quot; with &quot;<tt class=
      "constant">UI::responseData .=</tt>&quot;.</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="sec_handlers_packages">4.3.5. Packages
      (<tt class="classname">tarHandler</tt>, <tt class=
      "classname">gzipHandler</tt>)</a></h3>

      <p>These two handlers make tar and gzip -packages behave exactly
      like directories. If a tar or gzip -package is requested, handler
      extracts the package to a temporary directory and recurses into it
      pretty much as directory handler would.</p>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN373">4.3.6. Ejsc scripts (<tt class=
      "classname">ejscHandler</tt>)</a></h3>

      <p>This is an example of more advanced handler. It glues together a
      powerfull online geometric construction tool and a script compiler
      resulting remarkable ease of construction authoring. To learn more
      about these tools visit (<a href=
      "http://www.keypress.com/sketchpad/java_gsp/index.html" target=
      "_top">JavaSketchpad homepage</a> and read about Extended
      JavaSketchpad Construction Compiler from it&#39;s <a href=
      "http://www.maths.jyu.fi/~terotil/ejscc/doc/manual.html" target=
      "_top">manual</a>.</p>

      <p><tt class="classname">ejscHandler</tt> compiles requested script
      with ejscc and appends the result to template variable
      &quot;construction&quot;. &quot;Local&quot; template <tt class=
      "filename">scriptfile.ejsc.html</tt> is used if found and builtin
      default template otherwise. If script has preprocessor directives of
      the form</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000"> #define DEFAULT_variablename variablevalue</font>
</pre>
        </td>
       </tr>
      </table>

      <p>Now template variable &quot;variablename&quot; is set to
      &quot;variablevalue&quot; if not overriden by http get or post
      -parameter which takes precendance. Default template has variables
      &quot;string_name&quot; (page title), &quot;appletheight&quot;,
      &quot;appletwidth&quot;, &quot;codebase&quot; (applet codebase, set
      default in <tt class="filename">config.php</tt>) and
      &quot;construction&quot; (place for JSP construction).</p>

      <p>If you want to set, say page title form script, you put the
      following line in ejsc script file.</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000"> #define DEFAULT_string_name MyTitle</font>
</pre>
        </td>
       </tr>
      </table>

      <p>You can change it&#39;s template behaviour with ejsc_template
      -parameter. It has the following possible values.</p>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">local</tt></dt>

        <dd>
         <p>Local template (<tt class=
         "filename">scriptfile.ejsc.html</tt>) is used (if found,
         otherwise default) and template is nested.</p>
        </dd>

        <dt><tt class="constant">default</tt></dt>

        <dd>
         <p>Default template is used and it&#39;s nested.</p>
        </dd>

        <dt><tt class="constant">plain_local</tt></dt>

        <dd>
         <p>As <tt class="constant">local</tt> but template is set root
         (no previously set templates are used).</p>
        </dd>

        <dt><tt class="constant">plain_default</tt></dt>

        <dd>
         <p>As <tt class="constant">default</tt> but template is set
         root.</p>
        </dd>
       </dl>
      </div>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN412">4.3.7. Statement lists (<tt
      class="classname">statementlistHandler</tt>)</a></h3>

      <p>Simple way to set up true-false quiz. [FIXME: Complete
      this...]</p>
     </div>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_building_variables">4.4. Automatic
     template variables</a></h2>

     <p>Template variables (those strings in curly braces) get replaced by
     associated value if the data containing the variable is handled by
     template system. Package handlers and <tt class=
     "classname">asisHandler</tt> don&#39;t use template system to produce
     their output (package handlers don&#39;t provide any output and <tt
     class="classname">asisHandler</tt> serves the plain file as it
     is).</p>

     <p>Next chapters provide a brief but comprehensive description on the
     template variables that have automagical content.</p>

     <div class="section">
      <hr>

      <h3 class="section"><a name=
      "sec_building_variables_navigational">4.4.1. Navigational
      elements</a></h3>

      <p>A separate &quot;label mapper&quot; is responsible of mapping
      filenames to viewed names. If <tt class="classname">dirHandler</tt>
      encounters a <tt class="constant">map</tt> or <tt class=
      "constant">pseudo</tt> command in dotindex configuration file it
      adds a corresponding name mapping rule to label mapper. Default
      mapping is to remove file extension and leading number (if not
      configured otherwise), replace underscores with spaces and
      capitalize first letter. A few examples:</p>

      <table border="0" bgcolor="#E0E0E0" width="100%">
       <tr>
        <td>
<pre class="screen">
<font color="#000000"> a_file.txt --&gt; A file
 03_directory --&gt; Directory
 fancy_name_with_date_1.1.2000.html --&gt; Fancy name with date 1.1.2000</font>
</pre>
        </td>
       </tr>
      </table>

      <p>All these automatic navigational elements use those mapped names
      for files and directories.</p>

      <p>You can change the way these automatical elements render. Look
      for the available configuration items from <tt class=
      "filename">lib/henkariConfig.php</tt>.</p>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">{TOC}</tt></dt>

        <dd>
         <p>Table of contents reflects the underlying filesystem structure
         with exceptions described in dotindex -files (see <a href=
         "#dotindex">Section 3.3.2</a>). It folds automatically to form a
         minimal tree still having all the children of requested item
         visible.</p>
        </dd>

        <dt><tt class="constant">{menu}</tt></dt>

        <dd>
         <p>Menu contains parent and all the children of requested item.
         You can hide parent item from menu. Just put &quot;hide
         \.\.&quot; in your dotindex.</p>
        </dd>

        <dt><tt class="constant">{path}</tt></dt>

        <dd>
         <p>Path contains (as it&#39;s name suggests) the path from main
         page up to and including the viewed page. All path items are
         links which point to correspondig pages.</p>
        </dd>
       </dl>
      </div>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN449">4.4.2. Other automatic template
      variables</a></h3>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">{entrypoint_uri}</tt></dt>

        <dd>
         <p>Is replaced (a bit counter-intuitively) with an absolute path
         to <em>root directory of this entrypoint</em>. Assume you have
         henkari in <tt class="filename">henkari/</tt> with no special
         tricks (url rewrite, etc.) under your personal webspace which is
         visible on <tt class=
         "constant">http://www.myhost.com/~myself/</tt> and <tt class=
         "filename">mystyles.css</tt> in your <tt class=
         "filename">henkari/root/css/</tt> and you want to link it from
         you template with an absolute address so that it works in on
         every page. You can write <tt class=
         "filename">{entrypoint_uri}/css/mystyles.css</tt> and henkari
         resolves it to <tt class=
         "filename">/~myself/henkari/index.php/css/mystyles.css</tt>.</p>
        </dd>

        <dt><tt class="constant">{this_uri}</tt></dt>

        <dd>
         <p>Is replaced with an absolute path (see <tt class=
         "constant">{entrypoint_uri}</tt>) to requested file.</p>
        </dd>

        <dt><tt class="constant">{base_uri}</tt></dt>

        <dd>
         <p>Is replaced with an absolute path (see <tt class=
         "constant">{entrypoint_uri}</tt>) to the directory where
         requested file/directory resides.</p>
        </dd>

        <dt><tt class="constant">{title}</tt></dt>

        <dd>
         <p>Page title is placed here. Title is put together from pieces
         separated by <tt class=
         "constant">$config-&gt;title-&gt;separator</tt> and pieces are
         taken from titles of nested templates in the order they appear
         (and from requested html file if <tt class=
         "constant">htmlHandler</tt> was registered).</p>
        </dd>

        <dt><tt class="constant">{content}</tt></dt>

        <dd>
         <p>Page content is placed here.</p>
        </dd>

        <dt><tt class="constant">{date_modified}</tt></dt>

        <dd>
         <p>Is replaced with the last modification time of requested
         file/directory (if it exists). You can set date format in
         configuration.</p>
        </dd>
       </dl>
      </div>
     </div>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_includes">4.5. Includes</a></h2>

     <p>There&#39;s a special form of template variable (wich isn&#39;t
     actually handled with template system, but it behaves the same way)
     called include.Includes look like this.</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color="#000000"> {#include random_file.html}
 {#include /random/location/random_file.html}
 {#include http://randomhost/awesomereport.html}</font>
</pre>
       </td>
      </tr>
     </table>

     <p>Only whitespace allowed is the single space before filename. Two
     first examples are local files and the last one is a webpage. Local
     paths are taken relative to entrypoint directory. Content of the
     included file is assumed to be (x)html. <tt class=
     "constant">&lt;body&gt;</tt> tag is searched and if it&#39;s found
     only its contents are used. Otherwise the whole file is included.</p>

     <p>If you have fopen wrappers enabled on your php you can use
     ftp-paths and specify host port. If fopen wrappers are not availabe
     henkari uses builtin web retrieve which only supports http and port
     80.</p>

     <p>Note that only <tt class="constant">htmlHandler</tt> has this
     feature enabled. Includes work only in files handled by <tt class=
     "constant">htmlHandler</tt> unless you define your own handler which
     uses this feature (see <a href="#sec_extending">Section 5</a>).</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN504">4.6. Builtin server side
     cache</a></h2>

     <p>Every query is mapped to <tt class=
     "constant">$config-&gt;cachefile</tt> in <tt class=
     "constant">$config-&gt;cachedir</tt> (which you can set in <tt class=
     "filename">config.php</tt>. If cachefile is found (and cache is on,
     i.e. <tt class="constant">$config-&gt;cache = true</tt>, default is
     off) the file (along with its headers) is sent to browser and no
     handlers are created.</p>

     <p>If you change website content and want the pages be refreshed you
     have to empty cache directory. If you only have changed single page
     you only have to delete cache files of that particular page. Name of
     cachefile is of the form</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color="#000000"> henkaricache[requestpath].[crc]</font>
</pre>
       </td>
      </tr>
     </table>

     <p>Where [requestpath] is the requested path slashes (/) replaced
     with hashes (#) and [crc] is crc32 polynomial of serialized http
     parameters. So if you changed <tt class=
     "filename">root/info/news.html</tt> you only have to issue the
     following command in cache directory</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color="#000000"><tt class=
"prompt">bash$</tt> rm -f henkaricache#info#news.html.*</font>
</pre>
       </td>
      </tr>
     </table>

     <p>Cache is turned on from configuration where also the cachedir is
     set (as previously described). If you want to use cache (why not!)
     make sure that <tt class="constant">$config-&gt;cachedir</tt> exists
     and is writable by php. Note that sometimes server-side scripts (as
     php) are run with their owner/creator&#39;s account and sometimes
     with webserver&#39;s account. Find out wich one applies to your host
     and change cachedir&#39;s permissions to allow php-scripts to write
     there.</p>
    </div>
   </div>

   <div class="section">
    <hr>

    <h1 class="section"><a name="sec_extending">5. Extending</a></h1>

    <p>To extend henkari features you need at least basic programming
    skills and knowledge of php programming language (see <a href=
    "http://www.php.net/" target="_top">http://www.php.net/</a>).</p>

    <p>Henkari is extended by creating your own php scripts which take
    advantage of henkari environment. Another more advanced way is to
    create and register your own handler(s) to be responsible of your own
    special files.</p>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN524">5.1. User defined
     handlers</a></h2>

     <p>Possibilities with handlers are next to infinite. You could for
     example have handler for files containing SQL, which would connect
     database, execute query and render the result to html table. More
     advanced one would be general image handler, which would verify that
     the type of requested image is found from <tt class=
     "constant">Accept-Encoding</tt> header and if not, would try to
     convert requested image to one of the accepted types if possible.</p>

     <p>User defined handler is a correct solution when you have multitude
     of files that must be somehow prepared for viewing. Need for special
     behavior in a single point on your website is easier to satisfy by
     simple php-script.</p>

     <p>Creating your own handler starts (after you have decided that you
     really need it and this is the correct answer to problem in hand)
     with deciding where to put the physical file(s). If your handlers are
     strictly entrypoint spesific, you can create a directory for them
     under your entrypoint, for example <tt class=
     "constant">lib_local/</tt>. If your handler could be used more widely
     consider making it GPL, (eventually) placing it in your <tt class=
     "constant">lib/</tt> and informing henkari author. Next is to devise
     a name. Naming convention for handlers is <tt class=
     "classname">fooHandler</tt> where foo is the name of the thing this
     handler is intended to deal with. This will be the name of your
     handler class. Name the file containing the class <tt class=
     "filename">fooHandler.class.php</tt>.</p>

     <p>You define a handler by inheriting from <tt class=
     "classname">abstractHandler</tt> and overriding <tt class=
     "function">handle()</tt>. The following is the classic done properly
     as henkari handler.</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color="#000000">&lt;?php 
class helloHandler extends abstractHandler {
  function handle() {
    $ui =&amp; UI::getInstance();
    $hello = &#39;Hello World!&#39;;
    $ui-&lt;pageTitle($hello);
    $ui-&lt;appendToPage($hello);
  }
}
?&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>This is of course pretty braindead handler, because it doesn&#39;t
     do anything with the file it was commanded to handle.</p>

     <p>Your newly defined handler is put into action by registering it to
     be responsible of files of certain type. Let&#39;s given an example
     of it by putting our new handler to handle <tt class=
     "filename">*.hello</tt> files. This is accomplished by registering a
     file type and a handler for it in dothenkari. Assume that guidelines
     given for placing and naming handlers have been followed.</p>

     <table border="0" bgcolor="#E0E0E0" width="100%">
      <tr>
       <td>
<pre class="screen">
<font color="#000000">&lt;?php
$mi =&amp; MIME::getInstance();
$mi-&lt;bindExtensionToType(&#39;hello&#39;, &#39;application/x-hellotrigger&#39;);
$hf =&amp; handlerFactory::getInstance();
$hf-&lt;registerHandler(&#39;application/x-hellotrigger&#39;, 
                     &#39;helloHandler&#39;, 
                     &#39;lib_local/helloHandler.class.php&#39;);
?&gt;</font>
</pre>
       </td>
      </tr>
     </table>

     <p>First we bind file extension hello to a fabricated mime type. The
     the mime type is registered to be handled with <tt class=
     "classname">helloHandler</tt> which is defined in <tt class=
     "filename">lib_local/helloHandler.class.php</tt> relative to the
     entrypoint. Now for example request for file <tt class=
     "filename">say.hello</tt> results to a page saying &quot;Hello
     World!&quot; and your template neatly wrapped over it.</p>

     <p>To learn more about the possibilities, read short interface
     descriptions (see <a href="#sec_extending_interfaces">Section
     5.3</a>) and read sources.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="AEN548">5.2. Your PHP scripts in
     henkari</a></h2>

     <p>In henkari php scripts work pretty much as one would expect. You
     have henkari environment available, output of script ends up to page
     content and so on. You only have to keep in mind that your php code
     is executed in <tt class="function">handle()</tt> function of <tt
     class="classname">phpHandler</tt>, and not in global namespace as it
     normally would. This might change in future releases of php, so refer
     to php documentation to see how <tt class="function">include()</tt>
     works.</p>
    </div>

    <div class="section">
     <hr>

     <h2 class="section"><a name="sec_extending_interfaces">5.3.
     Interfaces</a></h2>

     <p>This is short description of the interfaces of henkari core
     components. Useful member functions and properties are described.</p>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN557">5.3.1. <tt class=
      "classname">UI</tt></a></h3>

      <p>Don&#39;t instantiate this class! Call <tt class=
      "function">UI::getInstance()</tt> to obtain an instance. Remember to
      assign return value from <tt class="function">getInstance()</tt>
      with referece assignment operator &quot;<tt class=
      "constant">=&amp;</tt>&quot;.</p>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">tpl</tt></dt>

        <dd>
         <p>An instance of phplib <tt class="classname">Template</tt>
         class. Set template variables using <tt class=
         "constant">tpl-&gt;set_var($name, $value);</tt>.</p>
        </dd>

        <dt><tt class="constant">labelMapper</tt></dt>

        <dd>
         <p>An instance of <tt class="classname">henkariLabelMapper</tt>
         inherited from <tt class="classname">labelMapper</tt>. See
         interface description of <tt class=
         "classname">labelMapper</tt>.</p>
        </dd>

        <dt><tt class="constant">responseData</tt></dt>

        <dd>
         <p>Holds the actual data to be sent in response to the recieved
         request. This becomes set only after handler recursion has been
         done. You can&#39;t check &quot;what the page would look
         like&quot; from here. If you want to bypass template system and
         all the nice features included, you can do it by setting the
         result data you want to this variable (and propably set headers
         too). <tt class="classname">asisHandler</tt> does this. Check an
         example from <tt class=
         "filename">lib/asisHandler.class.php</tt>.</p>
        </dd>

        <dt><tt class="constant">setTemplate($template,
        $override=false)</tt></dt>

        <dd>
         <p>Set page template. The first variable is the template (itself,
         not filename). Template is set to be root template when no
         template was previously se or <tt class="constant">$override</tt>
         is <tt class="constant">true</tt>. More about templates in <a
         href="#sec_templates">Section 4.2</a>.</p>
        </dd>

        <dt><tt class="constant">addHeader($h)</tt></dt>

        <dd>
         <p>Adds a http header to response. Use this if your response is
         of different type than <tt class="constant">text/html</tt>. See
         <tt class="filename">lib/asisHandler.class.php</tt> as an
         example.</p>
        </dd>

        <dt><tt class="constant">appendToPage($str, $var=false)</tt></dt>

        <dd>
         <p>Appends given string to template variable. If no variable is
         given <tt class="constant">content</tt> is used.</p>
        </dd>

        <dt><tt class="constant">pageTitle($str, $append=false)</tt></dt>

        <dd>
         <p>Sets page title to be given string. If <tt class=
         "constant">$append</tt> is <tt class="constant">true</tt> string
         is appended to variable, otherwise previous value is overriden.
         <tt class="constant">pageTitle(&#39;My Title&#39;, true);</tt> is
         equivalent to <tt class="constant">appendToPage(&#39;My
         Title&#39;, &#39;title&#39;);</tt></p>
        </dd>

        <dt><tt class="constant">isUndefined($variable)</tt></dt>

        <dd>
         <p>Checks if template system contains variable of given name as
         undefined variable. In here &quot;undefined&quot; means that
         there&#39;s <tt class="constant">{varname}</tt> somewhere in
         template, page content, etc. but there&#39;s no defined value
         corresponding to that variable.</p>
        </dd>

        <dt><tt class="constant">appendTo[TOC,Path,Menu]($uri,
        $label)</tt></dt>

        <dd>
         <p>Add an item to navigational elements, table of contents, path
         or menu. Takes as parameters the address and visible text to be
         used in links.</p>
        </dd>
       </dl>
      </div>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN628">5.3.2. <tt class=
      "classname">labelMapper</tt></a></h3>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">setLabel($key, $label)</tt></dt>

        <dd>
         <p>Sets the label of a key.</p>
        </dd>

        <dt><tt class="constant">getLabel($key)</tt></dt>

        <dd>
         <p>Returns the label corresponding to a key. If a label for
         requested key was explicitely set with <tt class=
         "function">setLabel()</tt> it&#39;s used. Otherwise label is
         obtained from <tt class="function">defaultLabel()</tt>.</p>
        </dd>

        <dt><tt class="constant">defaultLabel($key)</tt></dt>

        <dd>
         <p>Returns a default label for given key.</p>
        </dd>
       </dl>
      </div>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN649">5.3.3. <tt class=
      "classname">handlerFactory</tt></a></h3>

      <p>Don&#39;t instantiate this class! Call <tt class=
      "function">handlerFactory::getInstance()</tt> to obtain an instance.
      Remember to assign return value from <tt class=
      "function">getInstance()</tt> with referece assignment operator
      &quot;<tt class="constant">=&amp;</tt>&quot;.</p>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">registerHandler($mime, $classname,
        $classfile=&#39;&#39;)</tt></dt>

        <dd>
         <p>Registers class of given name to be responsible of handling
         the files of given type. If classfile is not explicitely given,
         the default policy <tt class=
         "filename">lib/[classname].class.php</tt> is assumed.</p>
        </dd>

        <dt><tt class="constant">createHandler($root_uri, $filename,
        $patharray)</tt></dt>

        <dd>
         <p>Instantiates a handler for <tt class="constant">$filename</tt>
         and returns a reference to it. Remember to assign return value
         with referece assignment operator &quot;<tt class=
         "constant">=&amp;</tt>&quot;. Other parameters are needed for
         handler instantiation. Read the description of <tt class=
         "classname">abstractHandler</tt> interface to learn more about
         them.</p>
        </dd>
       </dl>
      </div>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN671">5.3.4. <tt class=
      "classname">abstractHandler</tt></a></h3>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">patharray</tt></dt>

        <dd>
         <p>Request path from handled file to requested file. Stored in an
         array. For example <tt class=
         "filename">random/path/file.html</tt> would be <tt class=
         "constant">array(&quot;random&quot;, &quot;path&quot;,
         &quot;file.html&quot;)</tt>.</p>
        </dd>

        <dt><tt class="constant">filename</tt></dt>

        <dd>
         <p>Actual file (or directory) to be handled.</p>
        </dd>

        <dt><tt class="constant">root_uri</tt></dt>

        <dd>
         <p>Base for references created by this handler. In other words
         items contained by the thing pointed by <tt class=
         "constant">filename</tt> have <tt class="constant">root_uri</tt>
         as their base web address.</p>
        </dd>

        <dt><tt class="constant">isDirectory</tt></dt>

        <dd>
         <p>True if handled file is a directory. Defaults to false.</p>
        </dd>

        <dt><tt class="constant">tmpdir</tt></dt>

        <dd>
         <p>A directory where temporary files and directories created by
         this handler should be placed in.</p>
        </dd>

        <dt><tt class="function">createTmpDir()</tt></dt>

        <dd>
         <p>Create a new temporary directory inside default temporary
         directory and set <tt class="constant">tmpdir</tt> to point to
         this newly created directory.</p>
        </dd>

        <dt><tt class="function">removeTmpDir()</tt></dt>

        <dd>
         <p>Remove temporary directory created with <tt class=
         "function">createTmpDir()</tt>. If no new directory has been
         created this has no effect.</p>
        </dd>

        <dt><tt class="function">filecontents($file)</tt></dt>

        <dd>
         <p>Returns the contents of given file. Return value is empty if
         file doesn&#39;t exist or it cannot be read.</p>
        </dd>

        <dt><tt class="function">parseNested($page)</tt></dt>

        <dd>
         <p>Parse includes on given page. Read more from <a href=
         "#sec_includes">Section 4.5</a>.</p>
        </dd>

        <dt><tt class="function">writePathEntry($trailing_slash =
        false)</tt></dt>

        <dd>
         <p>Appends handled file to navigational element <tt class=
         "constant">{path}</tt> (see <a href=
         "#sec_building_variables">Section 4.4</a>). Trailing slash is
         appeded to directories. Behavior of this function can be
         controlled with <tt class=
         "constant">$config-&gt;path-&gt;files</tt> configuration option.
         It has three possible values: <tt class=
         "constant">&#39;none&#39;</tt> (no files are shown in path) <tt
         class="constant">&#39;noindex&#39;</tt> (index -files are hidden
         from path, default) <tt class="constant">&#39;all&#39;</tt> (all
         files are shown in path). Directories are always shown.</p>
        </dd>

        <dt><tt class="function">handle()</tt></dt>

        <dd>
         <p>Override this when you create your own handler.</p>
        </dd>
       </dl>
      </div>
     </div>

     <div class="section">
      <hr>

      <h3 class="section"><a name="AEN743">5.3.5. <tt class=
      "classname">MIME</tt></a></h3>

      <p>Don&#39;t instantiate this class! Call <tt class=
      "function">MIME::getInstance()</tt> to obtain an instance. Remember
      to assign return value from <tt class="function">getInstance()</tt>
      with referece assignment operator &quot;<tt class=
      "constant">=&amp;</tt>&quot;.</p>

      <div class="variablelist">
       <dl>
        <dt><tt class="constant">generic_type</tt></dt>

        <dd>
         <p>This mime type is returned when a mime type for file extension
         with no bindings is requested.</p>
        </dd>

        <dt><tt class=
        "function">getMimeTypeByFilename($filename)</tt></dt>

        <dd>
         <p>Returns an educated guess on mimetype based on filename.</p>
        </dd>

        <dt><tt class=
        "function">getMimeTypeByExtension($extension)</tt></dt>

        <dd>
         <p>Returns an educated guess on mimetype based on file
         extension.</p>
        </dd>

        <dt><tt class="function">bindExtensionToType($ext,
        $type)</tt></dt>

        <dd>
         <p>Binds the given file extension to given mime type.</p>
        </dd>
       </dl>
      </div>
     </div>
    </div>
   </div>

   <div class="appendix">
    <hr>

    <h1 class="appendix"><a name="AEN771">A. Appendices</a></h1>

    <div class="section">
     <h1 class="section"><a name="AEN773">A.1. License agreement</a></h1>

     <p>Henkari is free software; you can redistribute it and/or modify it
     under the terms of the <a href="http://www.gnu.org/copyleft/gpl.html"
     target="_top">GNU General Public License</a> as published by the Free
     Software Foundation; either version 2 of the License, or (at your
     option) any later version.</p>

     <p>Henkari is distributed in the hope that it will be useful, but
     WITHOUT ANY WARRANTY; without even the implied warranty of
     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
     General Public License (in <tt class="filename">./COPYING</tt>) for
     more details.</p>

     <p>You should have received a copy of the GNU General Public License
     along with this program; if not, write to the Free Software
     Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
     USA</p>
    </div>
   </div>
  </div>
 </body>
</html>

